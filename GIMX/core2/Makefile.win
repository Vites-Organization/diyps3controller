include ../Makedefs

BINS=emuclient usbspoof
LIB=-lmingw32 -lSDLmain -lSDL -llibxml2 -lws2_32 -liconv -lhid -lsetupapi -lpdcursesw -lintl
INC=-Iinclude

all: win gpp $(BINS)

clean:
	rm -f $(BINS) *~ *.o *.exe */*.o

emuclient: emuclient.o\
       args.o\
       display.o\
       sixaxis.o\
       dump.o\
       macros.o\
       config.o\
       config_writter.o\
       config_reader.o\
       sdl_tools.o\
       calibration.o\
       connector.o\
       serial_con.o\
       report.o\
       tcp_con.o\
       gpp/pcprog.o\
       gpp_con.o\
       gpp/hid_WINDOWS.o\
       windows/prio.o\
       windows/serial.o\
       windows/mainloop.o\
       windows/conversion.o
	$(CC) $(CFLAGS) $(INC) -o $@ $^ $(LIB)

usbspoof: utils/usbspoof.c utils/pcapwriter.c
	$(CC) -o $@ $^ -lusb-1.0 -lwinmm

gpp:
	$(CC) $(CFLAGS) -o gpp/hid_WINDOWS.o -c gpp/hid_LINUX.c
	$(CC) $(CFLAGS) -o gpp/pcprog.o -c gpp/pcprog.c
	$(CC) $(CFLAGS) -o gpp_con.o -c gpp_con.c

win:
	$(CC) $(CFLAGS) $(INC) -o windows/prio.o -c windows/prio.c
	$(CC) $(CFLAGS) $(INC) -o windows/serial.o -c windows/serial.c
	$(CC) $(CFLAGS) $(INC) -o windows/mainloop.o -c windows/mainloop.c
	$(CC) $(CFLAGS) $(INC) -o windows/conversion.o -c windows/conversion.c

%.o: %.c
	$(CC) $(CFLAGS) $(INC) -o $@ -c $< 
